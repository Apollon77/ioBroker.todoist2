<html>

<head>
    <!-- these 4 files always have to be included -->
    <link rel="stylesheet" type="text/css" href="../../css/adapter.css" />
    <link rel="stylesheet" type="text/css" href="../../lib/css/materialize.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/fancytree/ui.fancytree.min.css" />

    <script type="text/javascript" src="../../lib/js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="../../socket.io/socket.io.js"></script>

    <!-- these files always have to be included -->
    <script type="text/javascript" src="../../js/translate.js"></script>
    <script type="text/javascript" src="../../lib/js/materialize.js"></script>
    <script type="text/javascript" src="../../lib/js/selectID.js"></script>
    <script type="text/javascript" src="../../js/adapter-settings.js"></script>
    <script type="text/javascript" src="words.js"></script>

    <script type="text/javascript" src="../../lib/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../lib/js/jquery.fancytree-all.min.js"></script>

    <style>

        #dialog-list-edit {
            max-height: 95% !important;
            max-width: 85% !important;
            width: 80% !important;
            height: 90% !important;
            overflow: visible !important;
            top: 10px !important;
        }

        #dialog-select-member {
            max-height: 95% !important;
            max-width: 85% !important;
            width: 80% !important;
            height: 90% !important;
            overflow: visible !important;
            top: 10px !important;
        }

        redlabel { 
            color: red; 
        }

        .marg {
            margin-top: 2em;
        }
        .adapter-body {
            overflow: hidden !important;
        }
        table.highlight > tbody > tr {
            transition: background-color .25s ease !important;
        }
        table.highlight > tbody > tr:hover {
            background-color: rgba(200, 200, 200, 0.5) !important;
        }

        </style>
    
    <script type="text/javascript">
        
       //var isStarted =   null;


        

       function load(settings, onChange) {
            if (!settings) return;
            //$('#tabs').tabs();
            
            

            
            //if (!settings.pollingInterval) settings.pollingInterval = 60000;

            

            //        if (settings.restarted  === undefined || settings.restarted  === '_') settings.restarted = _('Started!');
            //        if (settings.restarting === undefined || settings.restarting === '_') settings.restarting = _('Restarting...');

            $('.value').each(function () {
                var key = $(this).attr('id');
                var $value = $('#' + key + '.value');
                if ($value.attr('type') === 'checkbox') {
                    $value.prop('checked', settings[key]).on('change', function () {
                        //showHideSettings();
                        onChange();
                    });
                } else {
                    $value.val(settings[key])
                        .on('change', onChange)
                        .on('keyup', function () {
                            onChange();
                        });
                }
            });

            events = settings.events    || [];
            onChange(false);
            console.log("values 2 tabel");
            values2table('lists', settings.rules, onChange, tableOnReady);

            $('#responseOIDDialog').on('click', function () {
                var devices = table2values('events');
                var id = 0;
                for (var i = 0; i < devices.length; i++) {
                id = id +1;
                }
                setTimeout(function () {
                    $('#events .values-input[data-name="triggerState"][data-index="' + id + '"]').val('true').trigger('change');
                    $('#events .values-input[data-name="typeUp"][data-index="' + id + '"]').val('sunrise').trigger('change');
                    $('#events .values-input[data-name="typeUp"][data-index="' + id + '"]').select();
                    $('#events .values-input[data-name="typeDown"][data-index="' + id + '"]').val('sunset').trigger('change');
                    $('#events .values-input[data-name="typeDown"][data-index="' + id + '"]').select();
                    $('#events .values-input[data-name="heightUp"][data-index="' + id + '"]').val('100').trigger('change');
                    $('#events .values-input[data-name="heightDown"][data-index="' + id + '"]').val('0').trigger('change');
                    $('#events .values-input[data-name="triggerDrive"][data-index="' + id + '"]').val('100').trigger('change');
                    $('#events .values-input[data-name="triggerChange"][data-index="' + id + '"]').val('off').trigger('change');
                    $('#events .values-input[data-name="elevation"][data-index="' + id + '"]').val('8').trigger('change');
                    $('#events .values-input[data-name="enabled"][data-index="' + id + '"]').prop('checked', true);
                    $('#events .values-input[data-name="type"][data-index="' + id + '"]').val('in- & outside temperature and direction').trigger('change');
                    $('#events .values-input[data-name="type"][data-index="' + id + '"]').select();
                    $('#events .values-input[data-name="heightDownSun"][data-index="' + id + '"]').val('30').trigger('change');
                    $('#events .values-input[data-name="direction"][data-index="' + id + '"]').val('120').trigger('change');
                    $('#events .values-input[data-name="directionRange"][data-index="' + id + '"]').val('50').trigger('change');
                    $('#events .values-input[data-name="tempInside"][data-index="' + id + '"]').val('23').trigger('change');
                    $('#events .values-input[data-name="tempOutside"][data-index="' + id + '"]').val('23').trigger('change');
                    $('#events .values-input[data-name="valueLight"][data-index="' + id + '"]').val('15').trigger('change');
                    $('#events .values-input[data-name="autoDrive"][data-index="' + id + '"]').val('off').trigger('change');
                    $('#events .values-input[data-name="hysteresisOutside"][data-index="' + id + '"]').val('5').trigger('change');
                    $('#events .values-input[data-name="hysteresisInside"][data-index="' + id + '"]').val('5').trigger('change');
                    $('#events .values-input[data-name="hysteresisLight"][data-index="' + id + '"]').val('5').trigger('change');
                }, 1000);
                
                initSelectId(function (sid) {
                    sid.selectId('show', $('#events .values-input[data-name="name"][data-index="' + id + '"]').val(), function (newId) {
                        if (newId) {
                            $('#events .values-input[data-name="name"][data-index="' + id + '"]').val(newId).trigger('change');
                            socket.emit('getObject', newId, function (err, obj) {
                                var name = getName(obj);
                                $('#events .values-input[data-name="shutterName"][data-index="' + id + '"]').val(name).trigger('change');
                            });
                        }
                    });
                });
            });

            if (M) M.updateTextFields();

            $('#userdiv').on('click', 'a', function () {
                const deleteID = $(this).attr("data-id");
                sendTo(null, 'delUser ' + deleteID, null, function (obj) {
                    $('#' + obj).remove();
                });
            });

            $('#messages').click(function () {
                if ($('#userTable').children().length === 0) {
                    sendTo(null, 'adminuser', null, function (obj) {
                        var text;
                        for (var key in obj) {
                            if (obj.hasOwnProperty(key)) {
                                text += '<tr id="' + key + '"><td>' + key + '</td><td>' + obj[key] + '</td><td><a id="delete" data-id="' + key + '" class="btn-floating waves-effect waves-light red btn-small button-delete"><i class="material-icons">delete</i></a></td></tr>'
                            }
                        }
                        $('#userTable').append(text);
                    });
                }
            });
        }
        

        function save(callback) {
  
            var obj = {};
            $('.value').each(function () {
                var $this = $(this);
                if ($this.attr('type') === 'checkbox') {
                    obj[$this.attr('id')] = $this.prop('checked');
                } else {
                    obj[$this.attr('id')] = $this.val();
                }
            });

            obj.rules = table2values();
            callback(obj);
        }

        function tableOnReady(){
        console.log("tables on Reday test");
        $('#events .table-values-div .table-values .values-buttons[data-command="edit"]').on('click', function () {
            console.log("-------hhaaaallloooo-----");
            //initDialogList();

            });

        }

        function initDialogList(callback) {
            var $editDialog = $('#dialog-list-edit');
            if (!$editDialog.data('inited')) {
                $editDialog.data('inited', true);
                $editDialog.modal({
                    dismissible: false
                });
                
                $editDialog.find('.btn-set').on('click', function () {
                    var $editDialog = $('#dialog-list-edit');
                    var callback = $editDialog.data('callback');
                    if (typeof callback === 'function') callback();
                    $editDialog.data('callback', null);
                });
            }
            $editDialog.data('callback', callback);
            $editDialog.modal('open');
        }


    </script>
</head>

<body>
    <!-- you have to put your config page in a div with id adapter-container -->
    <div class="m adapter-container">
        <div class="row" style="height: 100%;">
            <div class="col s12">
                <ul class="tabs">
                    <li class="tab col s3"><a href="#tab-main" class="translate active">Main settings</a></li>
                    <li class="tab col s3"><a href="#tab-lists" class="translate active">Lists</a></li>
                </ul>
            </div>
            <!-- Tab Main Settings-->
            <div id="tab-main" class="col s12 page">
                <div class="row">
                    <div class="col s6">
                        <img src="todoist.png" class="logo" alt="logo"/>
                    </div>
                </div>
                <div class="row">
                     <div class="input-field col s12 m8 l8 polling-settings">
                        <input id="pollingInterval" type="text" class="value" />
                        <label class="translate" for="pollingInterval">Polling interval (ms) use more than 60000 pls.</label>
                        <span></span>
                        
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12 m8 l8">
                        <input id="token" type="text" class="value" />
                        <label class="translate" for="token">token</label>
                        <span><a href="https://github.com/rde-master/ioBroker.todoist2" target="_blank" class="translate help">Read README.md how to get token</a></span>
                    </div>
                </div>
                <div class="col s12 m12 l12">
                    <h5>Einstellungen</h5>
                    <div class="input-field col s12 m4 l4">
                        <input id="debug" type="checkbox" class="value" />
                        <span class="translate" for="debug">debug</span>
                        <br><span class="translate">debug mode on</span>
                    </div>
                    <div class="input-field col s12 m4 l4">
                        <input id="dublicate" type="checkbox" class="value" />
                        <span class="translate" for="dublicate">Dublikate</span>
                        <br><span class="translate">Bereits angelegte Tasks (Dublikate) nicht erneut anlegen</span>
                </div>
                </div>
                <div class="col s12 m12 l12">
                    <h5>Auswahl Anlage Objekte</h5>
                <div class="input-field col s12 m4 l4">
                        <input id="project" type="checkbox" class="value" />
                        <span class="translate" for="project">Project</span>
                        <br><span class="translate">Projekte als Objekte anlegen</span>
                </div>
                <div class="input-field col s12 m4 l4">
                        <input id="section" type="checkbox" class="value" />
                        <span class="translate" for="section">Section</span>
                        <br><span class="translate">Section als Objekte anlegen</span>
                </div>
                <div class="input-field col s12 m4 l4">
                        <input id="tasks" type="checkbox" class="value" />
                        <span class="translate" for="tasks">Tasks</span>
                        <br><span class="translate">Tasks als Objekte anlegen</span>
                </div>
                <div class="input-field col s12 m4 l4">
                        <input id="labels" type="checkbox" class="value" />
                        <span class="translate" for="labels">Tasks</span>
                        <br><span class="translate">Labels als Objekte anlegen</span>
                </div>
            </div>
            <div class="col s12 m12 l12">
                <h5>Art der Objekte:</h5>
                <div class="input-field col s12 m4 l4">
                    <input id="html_objects" type="checkbox" class="value" />
                    <span class="translate" for="html_objects">HTML</span>
                    <br><span class="translate">HTML Objekte anlegen</span>
                </div>
                <div class="input-field col s12 m4 l4">
                    <input id="json_objects" type="checkbox" class="value" />
                    <span class="translate" for="json_objects">JSON</span>
                    <br><span class="translate">JSON Objekte anlegen</span>
                 </div>
                 <div class="input-field col s12 m4 l4">
                     <input id="text_objects" type="checkbox" class="value" />
                    <span class="translate" for="text_objects">Text</span>
                     <br><span class="translate">Text Objekte anlegen</span>
                 </div>
            </div>    
            </div>

        <div id="tab-lists" class="col s12 page">
            
            <div class="col s12" id="lists">
                <a class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>
                <div class="table-values-div">
                     <table id="table_lists" class="table-values" style="width: 100%;">
                        <thead>
                            <tr>
                                <th id="lists_col_0" data-name="isActive" data-type="checkbox" style="background: #64b5f6" class="translate">active</th>
                                <th id="lists_col_1" data-name="name" style="width: 20%; background: #64b5f6 " class="translate">Liste Name</th>
                                <th id="lists_col_2" data-name="project" style="width: 10%; background: #64b5f6" class="translate">Projekt ID</th>
                                <th id="lists_col_3" data-name="content" style="width: 70%; background: #64b5f6" class="translate">Content</th>
                                <th data-buttons="edit delete" style="width: 100px; background: #64b5f6"></th>

                            </tr>
                        </thead>
                    </table>
                </div>
                Content Example:
                [{"name":"-name-", "labels":[-labelid1-,-labelid2-], "priority":"-0-", "date":"YYYY-MM-DD"}]

                Name: please set the name
                Labels: 
                Priority:
                Date:
            </div>
            
        </div>    

        </div>
        <!--
        <div class="m material-dialogs">
            <div id="dialog-select-member" class="modal modal-fixed-footer">
                <div class="modal-content">
                    <div class="row">
                        <div class="col s12 title"></div>
                    </div>
                    <div class="row">
                        <div class="col s12 dialog-content">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a class="modal-action modal-close waves-effect waves-green btn btn-set"><i class="large material-icons left">check</i><span class="translate">Select</span></a>
                    <a class="modal-action modal-close waves-effect waves-green btn btn-close"><i class="large material-icons left ">close</i><span class="translate">Cancel</span></a>
                </div>
            </div>
            <div id="dialog-list-edit" class="modal modal-fixed-footer">
                <div class="row">
                    <div class="modal-content">

                        <div class="row">
                            <div class="col s12">
                                <h6 class="title"><span class="translate">Edit Room:</span> <span id="dialogDeviceEditRoom"></span></h6>
                            </div>
                        </div>
                        <div class="col s12">
                            <ul class="tabs">
                                <li class="tab col s4"><a href="#tab-popup_thermostats" class="translate active">thermostats</a></li>
                                <li id="page-actors" class="tab col s4"><a href="#tab-popup_actors" class="translate">actors</a></li>
                                <li id="page-sensors" class="tab col s4"><a href="#tab-popup_sensors" class="translate">sensors</a></li>
                            </ul>
                        </div>
                        <div id="tab-popup_thermostats" class="col s12 page">


                            <div class="col s12" id="thermostats">
                                <a class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>

                                <div class="table-values-div">
                                    <table id="table_thermostats" class="table-values" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th id="thermostat_col_0" data-name="id" style="background: #64b5f6;" class="translate">id</th>

                                                <th id="thermostat_col_1" data-name="name" style="background: #64b5f6" class="translate">thermostat</th>
                                                <th id="thermostat_col_2" data-name="OID_Current" style="background: #64b5f6" class="translate">OID current</th>
                                                <th id="thermostat_edit1" data-buttons="edit1" style="width: 100px; background: #64b5f6"></th>
                                                <th id="thermostat_col_3" data-name="OID_Target" style="background: #64b5f6" class="translate">OID target</th>
                                                <th id="thermostat_edit2" data-buttons="edit2" style="width: 100px; background: #64b5f6"></th>

                                                <th data-name="isActive" data-type="checkbox" style="background: #64b5f6" class="translate">active</th>
                                                <th data-buttons="delete" style="width: 100px; background: #64b5f6"></th>

                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a class="modal-action modal-close waves-effect waves-green btn btn-set"><i class="large material-icons left">check</i><span class="translate">Ok</span></a>
                    <a class="modal-action modal-close waves-effect waves-green btn btn-close"><i class="large material-icons left">close</i><span class="translate">Cancel</span></a>
                </div>
            </div>
        </div>  
    -->          
    </div>
</body>

</html>
